<?php /* ç¨‹åºä¾ ç‰ˆæƒæ‰€æœ‰ æŠ€æœ¯è®ºå›æ”¯æŒ: bbs.chengxuxia.com QQ: 573907419 æ­£ç‰ˆæˆæƒé˜²æ­¢å‡ºç°æ¼æ´åé—¨
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace ORG;error_reporting(E_ALL^E_NOTICE);define('Ã', 'Ì');—éõ˜“†™Ä¦¦Â½Ğ¯ìô×òË¬Éé¸ŸÔ÷¤í¶»ØÔ²ğç¹‹­ßšÓ£Ø¤ÓÅ™«¸åØ‚Ï’¢¥Š;$GLOBALS[Ã] = explode('|,|)|9', '¡Ş|,|)|9´¡|,|)|9| |3|-|,|)|9part| |3|-compress| |3|-backup_file| |3|-path| |3|-name| |3|-level| |3|-a| |3|--- -----------------------------
| |3|--- SentCMS MySQL Data Transfer 
| |3|--- 
| |3|--- Host     : | |3|-database.hostname| |3|-
| |3|--- Port     : | |3|-database.hostport| |3|--- Database : | |3|-database.database| |3|--- Date : | |3|-Y-m-d H:i:s| |3|--- -----------------------------

| |3|-SET FOREIGN_KEY_CHECKS = 0;

| |3|-Create Table| |3|-;

| |3|-0| |3|-count| |3|-addslashes| |3|-| |3|-\\r| |3|-\\n| |3|-\', \'| |3|-\');
| |3|-r| |3|-| |3|-/.*;$/');Áƒì–µİşïè­Ï„óÜ¦Ç¢ÀóÛ¦ÍŞö;error_reporting(E_ALL^E_NOTICE);define($GLOBALS{Ã}[0],$GLOBALS{Ã}{0x001});è´Ù“¥íÕªê¦Õ¹ì£¹÷ˆ˜¹ÉŒ­îı½ÆË³•±Ê‹°ğø†›ä­ñ›•Ø“ğÍçıúÖû¸ÇºÒ;$GLOBALS[¡Ş]=explode($GLOBALS{Ã}[0x0002],$GLOBALS{Ã}{0x00003});ï©÷ šğ§µÖÕ¨õğ½Ï…ÛÁÒÃ¿Î›»‡¹„ÁŒá®ü‹¦¦˜ÅÜï›…åÂ¶’Ÿ÷åâ¸´şô¼¸øşÅÛ­ÂçÔàí§êİÂïÄĞ³úâÒóÉ¶¬ıµ¡ºîš¹´õç÷Ş½Ùì«Ø‰ÄÉÎ•üÉøĞ½Â‡éÁ¼‹ü«¦·àŸÙûİ³é‰µÃ“úá‹¬‰ÛéÌãÔ ß;use think\Db;class Database{private $fp;private $file;private $size=0;private $config;public function __construct($¼‹Ë,$ÎŞíÜÁ,$çíˆÄØ='export'){$this->file=$¼‹Ë;äÈğ–•´Äº˜ÍÛÙ‹;˜Õ‹·ƒÖı¸øÎ;·…ë”Çêû¶óÀÉè¼®²ËŸÉàÓ›ìÜöÆçßìæ—òÒ«º¾;$this->config=$ÎŞíÜÁ;¤çñ¥õØ€¦­ï´ÇŸèˆôù Ë…ØÏÜÖˆÕ¦â®õˆ¼ŞúâÕÓâûÓ±Éó;üÓ¾¬†ŠÌĞê ß‡¼şÔ¥ŞÂŒõµß¢ğÊãÑ´äÏˆ£û®È;}private function open($šé¿¢){$ü¡Í¢=&$GLOBALS{¡Ş};if($this->fp){$this->size += $šé¿¢;if($this->size >$this->config[$ü¡Í¢[0]]){$this->config[$ü¡Í¢{0x001}]?@gzclose($this->fp):@fclose($this->fp);$this->fp=null;$this->file[$ü¡Í¢[0]]++;session($ü¡Í¢[0x0002],$this->file);$this->create();}}else{$öÇ=$this->config[$ü¡Í¢{0x00003}];$¹®="{$öÇ}{$this->file[$ü¡Í¢[0x000004]]}-{$this->file[$ü¡Í¢[0]]}.sql";š;ÌÊğú;if($this->config[$ü¡Í¢{0x001}]){$¹®="{$¹®}.gz";$this->fp=@gzopen($¹®,"a{$this->config[$ü¡Í¢{0x05}]}");Í²Õ—“ï‚Ò’úĞ;Ÿó›ôÈığÊÒ£•Æ¾ç¯ÓÚäí§éåËö³–ç¯×áçöÕ„ìŸƒŞéÕ‚şœ;}else{$this->fp=@fopen($¹®,$ü¡Í¢[0x006]);Ú¢­¢²ÇÛà¬øâÆû´é¢ƒœ÷š¯èƒú™Ó¯âÇå¾ê“áÚ½ş;”Â±ƒê›è·“ÎûÌ¦İ´³¹‹Ò¼é½’ì½¯®¥ûÂè®ÆÔÊ¯ŒİÌÛÚš‚¸Ï¡ë‰;}$this->size=filesize($¹®)+$šé¿¢;}}public function create(){$ÖšÔ=&$GLOBALS{¡Ş};$‰µìİ=$ÖšÔ{0x0007};Ë‘Şğ¯¹¯¯Áæ’›©ÈòÃÃø;Ê´½Ÿşí¬İ»‰¸ÕŒ;¹‹˜Š±ã™ÃÂ‹óüº¤¾¢¶;$‰µìİ.= $ÖšÔ[0x00008];˜±¥¶ôÚñë‰¥¥”½°Æ¡É‹äÕşá¤ ³Ûïñ¼ˆ£â¾™‚šŒí£±;İ®ÚôòœÍ÷ØÖ«º;‘;$‰µìİ.= $ÖšÔ{0x000009};‘à;ô¯ù©‹é›Èñ¿«±Ø;$‰µìİ.= $ÖšÔ[0x0a].config($ÖšÔ{0x00b}).$ÖšÔ[0x000c];$‰µìİ.= $ÖšÔ{0x0000d}.config($ÖšÔ[0x00000e]).$ÖšÔ[0x000c];©‡ô©™…´éÀ;$‰µìİ.= $ÖšÔ{0x0f}.config($ÖšÔ[0x0010]).$ÖšÔ[0x000c];ã‰üÎ¤ÅÀãñò½ ¿£½¯ºîÙÂäƒÛé·ìÓøÖ³éº¼æ‰á­ÊÆŸ½„Àı¨ş®ãíˆ¦Ò‹ƒ¼Ãï¼ÆÄ¦‚‹ã»Õ;ŠÛ§àç™†•öµğ•«ã±øÛ‹ĞˆÅ­«Ë¾ŒñÎÛÄ¾æ¡åÇ‰şÎŸö„Œ¯ô¾©ĞÉùÙ¨†Ûæ“Î¶î;$‰µìİ.= $ÖšÔ{0x000009};œ’ØœÀ¼ŠÈâÜ;$‰µìİ.= "-- Part : #{$this->file[$ÖšÔ[0]]}\n";˜Ö«ÔïûŸñŠªÖÅƒ¡•³;Û¿ÚìŞÒğïŞ¡äÊ¶èÅ‘øí—ÕÕª¤Œš¸‚ï;$‰µìİ.= $ÖšÔ{0x00011}.date($ÖšÔ[0x000012]).$ÖšÔ[0x000c];®¹úŒìşê;$‰µìİ.= $ÖšÔ{0x0000013};ä²¬Â‡“ÜŸê‰ó‰øğ©ëúÔÃÁÕÆâëù¡”†ûüÏá¯ü¤¶‘‚Öû‹Ë……¼®ğ¸„;›òŸ¬ëÃÂãîæğ;$‰µìİ.= $ÖšÔ[0x014];İÅõşÚûû×ÌİˆÉƒ¿Ú†–×’âÜ—ŸŒ‰×¾Òê¹°±°¯Œ¬¬äù‹íÃ­Ÿ•Äö§§Ô¿ÇáÈ ò‡òİÁ£ñÓœŸ™Œ;return $this->write($‰µìİ);ü°âôØ‹É˜Ó«àóèæü;}private function write($ßª){$à«Ö=&$GLOBALS{¡Ş};ˆ¹³¹¨’©ñªüŒ;$½ôØº¡=strlen($ßª);Äòû¥ŸÓ“ºŠœô½Õ’åç»Ø“¸öŸª´•ƒï¶ç¸õ;$½ôØº¡=$this->config[$à«Ö{0x001}]?$½ôØº¡/0x0002:$½ôØº¡;$this->open($½ôØº¡);return $this->config[$à«Ö{0x001}]?@gzwrite($this->fp,$ßª):@fwrite($this->fp,$ßª);Çæ†ÑƒúÙöÂÊÏÖ„Çö®üŒ±ìÃš¦ºÆÑ®šõ¤È…ŸÙß®Ğ;ú;}public function backup($ğ«æıİ,$Â÷úü){$Í¬Ú=&$GLOBALS{¡Ş};ëâ¯ÅÂİ–æ×¸àÕ¢Ò‚‰ĞàŞ”ØÙ’™;$¾ó=\think\Db::connect();if(0==$Â÷úü){$Ğ¢Í³=$¾ó->query("SHOW CREATE TABLE `{$ğ«æıİ}`");$“ö°ª=$Í¬Ú[0x000c];¿ß†’áãÂî÷œÈ‹;£Õ‰Â“Úò;$“ö°ª.= $Í¬Ú{0x0007};ƒ«û¦ù°ø¨ª¸†³œÆ“¢Ùõ²½;$“ö°ª.= "-- Table structure for `{$ğ«æıİ}`\n";$“ö°ª.= $Í¬Ú{0x0007};$“ö°ª.= "DROP TABLE IF EXISTS `{$ğ«æıİ}`;\n";³ï‹×©“‡çéÍ™–ÊãìØ‡Ãá¤‡ô€ùöˆ„Ø;ŒÛŒ·Ş¸³†²äşÀ©ø”İ•Ûğ·µçêó¡«ö÷í„Ôú»´³ïºåÕ¹¦ââ;$“ö°ª.= trim($Ğ¢Í³[0][$Í¬Ú{0x0015}]).$Í¬Ú[0x00016];¸ÑäáäìÊ;Ó²í‰›Øı¼æ©´ß—¸´’ôèÆå£¬¼İ;if(!0x001===$this->write($“ö°ª)){return !0x001;}}$Ğ¢Í³=$¾ó->query("SELECT COUNT(*) AS count FROM `{$ğ«æıİ}`");ô˜ƒªìµ™öÑñôÙÂ¹¶;ÜĞ¯Á¾ˆÈ‚éì‰ßìƒÖõ‡¯¾Î¼ö ¢Ù†¤ÕÊ‰³œ¸ôÚÁ½Ü¬;ñ×Øû¼•Ù‘µœ†ÎŸ±»ÕÊ³§½¨µ˜ÇøÑıõÀÇç˜ÖÁ””×î¦‹­Ü«ß™ªÌ¨;$ôŞ¼Ø=$Ğ¢Í³[$Í¬Ú{0x000017}][$Í¬Ú[0x0000018]];”ƒ·¬ÚøÁîÑ±–Ş½Ã¼è£ÕéÎ£“¸™òºÖË’š£•;if($ôŞ¼Ø){if(0==$Â÷úü){$“ö°ª=$Í¬Ú{0x0007};$“ö°ª.= "-- Records of `{$ğ«æıİ}`\n";$“ö°ª.= $Í¬Ú{0x0007};Ì’ßÄöı‚»»êŞ‘Õ®µéçÎÜ¢¥¨±¸ÃÔÎ–¥¾ã¸Ÿƒü–€Ñ¼ê±ÎÁà„«ÈÓˆëù±³ôó‚;ğ”ÍÀĞÅàó ç;$this->write($“ö°ª);}$Ğ¢Í³=$¾ó->query("SELECT * FROM `{$ğ«æıİ}` LIMIT {$Â÷úü}, 1000");àóĞ÷ôÑÊ²½üşİ†«§Ú³”Õä²‰Ú§‹çÁÌØ•­Ìæ¦Â¸ğôõíöõÌı¡óØÕˆ®»»·–âÃş¥;ÎñêˆæÅÉ¥¢öĞ‰ƒéòçøäûÇ¥Í‡Á®îÆô­–ÃŸ;foreach($Ğ¢Í³ as $º¾¥¡){$º¾¥¡=array_map($Í¬Ú{0x019},$º¾¥¡);ÖİÑÄÔÇ’Òé†¬¿ÛûÊ”“®×’Óèê§°øŒãÖİ©¬¦»€Â¬ĞÑ‰ÌßÌõò Şİ¯†íà“;ó’ççùáÌõªòÄ¸ù‡çéÍÜ—ã;¾Ë¡êòİê„ ˜Ôñ¡¢¾ƒÜ´õü“Ô­šÂ®ªü¦èÈÈÔ¼¦¿ÀÆ×–¹ø¹É¸¼¦í³¤‚ˆÑœËàËõŞñß¨»´äáô¥©Ì¼âÆõ¬ş³Òìæö;$“ö°ª="INSERT INTO `{$ğ«æıİ}` VALUES ('".str_replace(array($Í¬Ú[0x001a],$Í¬Ú[0x000c]),array($Í¬Ú{0x0001b},$Í¬Ú[0x00001c]),implode($Í¬Ú{0x000001d},$º¾¥¡)).$Í¬Ú[0x01e];Œ»«×²ŠÊ’²†Ç˜è¼¾’ŠúôĞğ¡Ï¤ô½Œë¬û¶¸·á‘êìÛıŸâÅ¸ËƒöŞñÓİã;if(!0x001===$this->write($“ö°ª)){return !0x001;}}if($ôŞ¼Ø>$Â÷úü+0x03e8){return array($Â÷úü+0x03e8,$ôŞ¼Ø);}}return 0;êë•×;}public function import($Ñ){$ğâµ=&$GLOBALS{¡Ş};ı£ù¶îü®ÎŠ £è„™—…ƒ£İœ´ì;$şŞÑ´½=\think\Db::connect();if($this->config[$ğâµ{0x001}]){$¼µâó¥=gzopen($this->file[0x001],$ğâµ{0x001f});$¢óêÂ=0;}else{$¢óêÂ=filesize($this->file[0x001]);$¼µâó¥=fopen($this->file[0x001],$ğâµ{0x001f});}$Ó=$ğâµ[0x00020];if($Ñ){$this->config[$ğâµ{0x001}]?gzseek($¼µâó¥,$Ñ):fseek($¼µâó¥,$Ñ);}for($±ëÕ=0;$±ëÕ<0x03e8;$±ëÕ++){$Ó.= $this->config[$ğâµ{0x001}]?gzgets($¼µâó¥):fgets($¼µâó¥);Ğ«ÍÆÌ€ŠäİÁÁòò;‹®ƒù®âÌã¡ßÌİ•¯Ñ»;if(preg_match($ğâµ{0x000021},trim($Ó))){if(!0x001!==$şŞÑ´½->execute($Ó)){$Ñ+= strlen($Ó);}else{return !0x001;}$Ó=$ğâµ[0x00020];}elseif($this->config[$ğâµ{0x001}]?gzeof($¼µâó¥):feof($¼µâó¥)){return 0;}}return array($Ñ,$¢óêÂ);·ÇÏ€ù»Ö±«ÏÇ·şË²®®ş’ÏŞŞ®ô€° õàœ®©ë®¤¨†ÕÓÕŒ;}public function __destruct(){}}