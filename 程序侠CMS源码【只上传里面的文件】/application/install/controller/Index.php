<?php /* 程序侠版权所有 技术论坛支持: bbs.chengxuxia.com QQ: 573907419 正版授权防止出现漏洞后门
-- enphp : https://git.oschina.net/mz/mzphp2
 */   namespace app\install\controller;error_reporting(E_ALL^E_NOTICE);define('П', '');ʂշ✓ҋܫť֛ߡ攀Ǹ򭂕٢ș߯٬̦ˌꊡїƫшʛ⧐;$_GET[П] = explode('|*|&|4', '|*|&|4|*|&|4|?|4|?|*|&|4./runtime/目录不可写，请将该目录及下面文件权限设置成777|?|4|?./data/目录不可写，请将该目录及下面文件权限设置成777|?|4|?data/install.lock|?|4|?已经成功安装了程序侠CMS，请不要重复安装!|?|4|?http://|?|4|?HTTP_HOST|?|4|?index.php|?|4|?staticDir|?|4|?static/|?|4|?step|?|4|?error|?|4|?请按顺序安装|?|4|?index|?|4|?checkEnv|?|4|?checkDirFile|?|4|?checkDB|?|4|?checkOther|?|4|?环境检测没有通过！|?|4|?恭喜您环境检测通过|?|4|?db|?|4|?hostname|?|4|?数据库地址不能为空|?|4|?database|?|4|?数据库名称不能为空|?|4|?username|?|4|?数据库用户名不能为空|?|4|?password|?|4|?数据库密码不能为空|?|4|?hostport|?|4|?admin|?|4|?管理员账号不能为空|?|4|?管理员密码不能为空|?|4|?dbConfig|?|4|?adminConfig|?|4|?select version()|?|4|?数据库连接失败，请检查数据库配置！|?|4|?cover|?|4|?SELECT * FROM information_schema.schemata WHERE schema_name="|?|4|?"|?|4|?该数据库已存在|?|4|?参数正确开始安装|?|4|?step3|?|4|?prefix|?|4|?);|?|4|?管理员信息初始化 <i class=\'am-icon-check am-text-success\'></i>|?|4|?success|?|4|?管理员信息初始化 <i class=\'am-icon-times am-text-danger\'></i>|?|4|?danger|?|4|?安装出错，错误细节请查看Log！|?|4|?<meta http-equiv=\'Refresh\' content=\'0;URL=|?|4|??s=/install/index/complete.html\'>|?|4|?请正确安装系统|?|4|?lock|?|4|?开始写入配置文件...|?|4|?info|?|4|?data|?|4|?.tpl|?|4|?.php|?|4|?写入配置文件|?|4|? <i class=\'am-icon-check am-text-success\'></i>|?|4|? <i class=\'am-icon-times am-text-danger\'></i>！|?|4|?install|?|4|?chengxuxiaInstall.sql|?|4|?|?|4|?
|?|4|?;
|?|4|?default_table_prefix|?|4|?开始安装数据库...|?|4|?CREATE TABLE|?|4|?/^CREATE TABLE `(\\w+)` .*/s|?|4|?\\1');게Ό涘ˋ͊آ҆ђݹﱓᗬӓ埤ʴϱ˟Õщܱߨﵾ։ݣ輜;error_reporting(E_ALL^E_NOTICE);define($_GET{П}{0},$_GET{П}[0x001]);֠ԭűȌǉ𲾿ϏƃɿƳӷ⣁º;$_SERVER[]=explode($_GET{П}{0x0002},$_GET{П}[0x00003]);ȓƁְ⌴Ϣޞ¹Ǝɮ؎ͬɀΫ;use think\Controller;use think\Db;class Index extends Controller{protected function _initialize(){$=&$_SERVER{};$=RUNTIME_PATH;ʥ̥Ӯ텯ǭ 栃شӛݚܐ孝µ;Š;;if(!is_writable(RUNTIME_PATH)){echo $[0];return !0x001;}if(!is_writable(CXXIA_DATA_PATH)){echo ${0x001};return !0x001;}if(is_file(ROOT_PATH.$[0x0002])){$this->error(${0x00003},$[0x000004].$_SERVER[${0x05}]);}$=$this->request->baseFile();$=rtrim($,$[0x006]);ú߼ג;$this->assign(${0x0007},$.$[0x00008]);ߪښ;דƬꏡ݂;}public function index(){$缴=&$_SERVER{};session($缴{0x000009},0x001);session($缴[0x0a],!0x001);return $this->fetch();üՄޮ;ģګҢ;}public function step2(){$=&$_SERVER{};ٜ;if(session(${0x000009})!=0x001&& session(${0x000009})!=0x00003){$this->error(${0x00b},url($[0x000c]));}else{session(${0x000009},0x0002);session($[0x0a],!0x001);$this->assign(${0x0000d},checkEnv());$this->assign($[0x00000e],checkDirFile());$this->assign(${0x0f},checkMySQL());$this->assign($[0x0010],checkOther());return $this->fetch();}}public function step3(){$=&$_SERVER{};if($this->request->isAjax()){if(session($[0x0a])){return $this->error(${0x00011});}else{return $this->success($[0x000012]);}}else{if(session(${0x000009})!=0x0002&& session(${0x000009})!=0x000004){$this->error(${0x00b},url($[0x000c]));}session($[0x0a],!0x001);session(${0x000009},0x00003);;return $this->fetch();ڵŘ򒎹ı;}}public function step4(){$=&$_SERVER{};ѐŝߛӰ;if($this->request->isPost()){$Ձ=$this->request->param();if(empty($Ձ[${0x0000013}][$[0x014]])){$this->error(${0x0015});}if(empty($Ձ[${0x0000013}][$[0x00016]])){$this->error(${0x000017});}if(empty($Ձ[${0x0000013}][$[0x0000018]])){$this->error(${0x019});}if(empty($Ձ[${0x0000013}][$[0x001a]])){$this->error(${0x0001b});}if(empty($Ձ[${0x0000013}][$[0x00001c]])){$Ձ[${0x0000013}][$[0x00001c]]=0x00cea;}if(empty($Ձ[${0x000001d}][$[0x0000018]])){$this->error($[0x01e]);}if(empty($Ձ[${0x000001d}][$[0x001a]])){$this->error(${0x001f});}session($[0x00020],$Ձ[${0x0000013}]);session(${0x000021},$Ձ[${0x000001d}]);åȜ;$Ē=$Ձ[${0x0000013}][$[0x00016]];Ϧ׽񖏵ëڐׂ۟;unset($Ձ[${0x0000013}][$[0x00016]]);$=Db::connect($Ձ[${0x0000013}]);;try{$->execute($[0x0000022]);вنǓ;갼辝֕;ӡȔ;}catch(\Exception$){$this->error(${0x023});ߑ幤תӿݲϥīΜգ;ϊ¤דܙǞמŰͧ;}if(!isset($Ձ[$[0x0024]])){$=$->execute(${0x00025}.$Ē.$[0x000026]);if($){$this->error(${0x0000027});}}$="CREATE DATABASE IF NOT EXISTS `{$Ē}` DEFAULT CHARACTER SET utf8";͚Ŵ؍;$->execute($)|| $this->error($->getError());;$this->success($[0x028]);۬;נ;}else{if(session(${0x000009})!=0x00003){$this->error(${0x00b},url(${0x0029}));}else{session(${0x000009},0x000004);session($[0x0a],!0x001);echo $this->fetch();$հ=session($[0x00020]);$=session(${0x000021});$Ē=$հ[$[0x00016]];$˳=$this->request->ip();$=MD5($[$[0x001a]]);$=Db::connect($հ);$this->writeConfig($հ,$[0x00016],APP_PATH);$this->executeSQL($,$հ[$[0x0002a]]);$="INSERT INTO `{$հ[$[0x0002a]]}admin_user` (`username`, `gid`, `password`, `last_login_ip`, `status`, `create_time`) "."VALUES ('{$[$[0x0000018]]}',1,'{$}','{$˳}',1,".time().${0x00002b};ʫٲᩑɉז۞Ҵ;ୈޔջ;if($->execute($)){showMsg($[0x000002c],${0x02d});}else{showMsg($[0x002e],${0x0002f});session($[0x0a],!0);}if(session($[0x0a])){$this->error($[0x000030],url($[0x000c]));}else{$=${0x0000031}.request()->baseFile().$[0x032];exit($);}}}}public function complete(){$=&$_SERVER{};if(session(${0x000009})!==0x000004){$this->error(${0x0033},url($[0x000c]));}file_put_contents(ROOT_PATH.$[0x0002],$[0x00034]);session(null);return $this->fetch();ߢ驻՝ƶꁋ찤;Ԭנ;;}private function writeConfig($ɯ,$,$){$ލ=&$_SERVER{};if(is_array($ɯ)){showMsg($ލ{0x000035},$ލ[0x0000036]);$=file_get_contents(APP_PATH.$this->request->module().DS.$ލ{0x037}.DS.$.$ލ[0x0038]);foreach($ɯ as $υ=>$){$=str_replace("[{$υ}]",$,$);}if(file_put_contents($.$.$ލ{0x00039},$)){showMsg($ލ[0x00003a].$.$ލ{0x000003b},$ލ{0x02d});}else{showMsg($ލ[0x00003a].$.$ލ[0x03c],$ލ{0x0002f});session($ލ[0x0a],!0);}return !0;}}private function executeSQL($,$=''){$=&$_SERVER{};$=\chengxuxia\File::cxxia_read_file(APP_PATH.${0x003d}.DS.${0x037}.DS.$[0x0003e]);ʤϻڢĀ߰Đ;$=str_replace(${0x00003f},$[0x0000040],$);$=explode(${0x041},$);ܸÇ;$ێ=config($[0x0042]);П;;$=str_replace(" `{$ێ}"," `{$}",$);ٝ߃;showMsg(${0x00043},$[0x0000036]);;ߞ;foreach($ as $𦕬){$𦕬=trim($𦕬);Ę잂;if(empty($𦕬))continue;if(strpos($𦕬,$[0x000044])!==!0x001){$=preg_replace(${0x0000045},$[0x046],$𦕬);$Ӑ="创建数据表{$}";if(!0x001!==$->execute($𦕬)){showMsg($Ӑ.${0x000003b},${0x02d});}else{showMsg($Ӑ.$[0x03c],${0x0002f});session($[0x0a],!0);}}else{$->execute($𦕬);ۀͩ؃;;ّÎ٠̕ѫʀ;}}}}